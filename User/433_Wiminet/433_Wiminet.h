#ifndef _433_WIMINET_H_
#define _433_WIMINET_H_
#include "stm32f10x.h"

//------------------------------------------------------------------------------
// DESCRIPTION: 请求命令字的起始序号
// -----------------------------------------------------------------------------
#define CMDMSG_BASE                       0X00
// -----------------------------------------------------------------------------
// DESCRIPTION: 其他类设备:请求命令字的起始序号
// -----------------------------------------------------------------------------
#define MACHINE_CMDBASE                   ( CMDMSG_BASE + 0X70 ) 
// -----------------------------------------------------------------------------
// DESCRIPTION: 其他类设备的请求命令字:读取根节点MAC地址
// -----------------------------------------------------------------------------
#define CMDMSG_GET_COORDINATOR_ID         ( MACHINE_CMDBASE + 0X06 )


// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#if defined ( __CC_ARM ) 

// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#pragma push

// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#pragma pack( 1 )

// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#endif



//结构体声明
// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
typedef struct _NodeMsg
{
   // --------------------------------------------------------------------------
   // DESCRIPTION: 同步字符
   // --------------------------------------------------------------------------
   unsigned char                                               m_iHeader;
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 报文操作命令
   // --------------------------------------------------------------------------
   unsigned char                                               m_iOpCode;
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 可选操作参数-A
   // --------------------------------------------------------------------------
   unsigned char                                               m_iValueA;
      
   // --------------------------------------------------------------------------
   // DESCRIPTION: 可选操作参数-B
   // --------------------------------------------------------------------------
   unsigned char                                               m_iValueB;
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: ?可选操作参数-C
   // --------------------------------------------------------------------------
   unsigned char                                               m_iValueC;
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 可选操作参数-D
   // --------------------------------------------------------------------------
   unsigned char                                               m_iValueD;
      
   // --------------------------------------------------------------------------
   // DESCRIPTION: 报文长度
   // --------------------------------------------------------------------------
   unsigned char                                               m_iAmount;  
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 报文的CRC校验码
   // --------------------------------------------------------------------------
   unsigned short                                              m_iCRCode;
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 报文实体
   // --------------------------------------------------------------------------
   unsigned char                                               m_pBuffer[255];  
   
} NodeMsg;

//结构体声明
// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
typedef struct _SLNoiseSet
{
   // --------------------------------------------------------------------------
   // DESCRIPTION: 前导码
   // --------------------------------------------------------------------------
   unsigned char                                               m_Preamble[1];
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 版本号
   // --------------------------------------------------------------------------
   unsigned char                                               m_Version[1];
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 字符串长度
   // --------------------------------------------------------------------------
   unsigned char                                               m_Leng[2];
      
   // --------------------------------------------------------------------------
   // DESCRIPTION: 设备编号
   // --------------------------------------------------------------------------
   unsigned char                                               m_DeviceId[6];
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 路由标志
   // --------------------------------------------------------------------------
   unsigned char                                               m_RouteMark[1];
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 路由节点地址
   // --------------------------------------------------------------------------
   unsigned char                                               m_RouteSite[2];
      
   // --------------------------------------------------------------------------
   // DESCRIPTION: 操作类型
   // --------------------------------------------------------------------------
   unsigned char                                               m_PDUType[2];  
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 报文序号
   // --------------------------------------------------------------------------
   unsigned char                                               m_Sep[1];

   // --------------------------------------------------------------------------
   // DESCRIPTION: 系统日期时间Tag的Oid
   // --------------------------------------------------------------------------
   unsigned char                                               m_SystemTimeOid[4]; 
   // --------------------------------------------------------------------------
   // DESCRIPTION: 系统日期时间Tag的Len
   // --------------------------------------------------------------------------
   unsigned char                                               m_SystemTimeLen[2];  
   // --------------------------------------------------------------------------
   // DESCRIPTION: 系统日期时间Tag的Value
   // --------------------------------------------------------------------------
   unsigned char                                               m_SystemTimeValue[6];

   // --------------------------------------------------------------------------
   // DESCRIPTION: 采集起始时间Tag的Oid
   // --------------------------------------------------------------------------
   unsigned char                                               m_StartTimeOid[4]; 
   // --------------------------------------------------------------------------
   // DESCRIPTION: 采集起始时间Tag的Len
   // --------------------------------------------------------------------------
   unsigned char                                               m_StartTimeLen[2];  
   // --------------------------------------------------------------------------
   // DESCRIPTION: 采集起始时间Tag的Value
   // --------------------------------------------------------------------------
   unsigned char                                               m_StartTimeValue[2];

   // --------------------------------------------------------------------------
   // DESCRIPTION: 采集间隔Tag的Oid
   // --------------------------------------------------------------------------
   unsigned char                                               m_SpanOid[4]; 
   // --------------------------------------------------------------------------
   // DESCRIPTION: 采集间隔Tag的Len
   // --------------------------------------------------------------------------
   unsigned char                                               m_SpanLen[2];  
   // --------------------------------------------------------------------------
   // DESCRIPTION: 采集间隔Tag的Value
   // --------------------------------------------------------------------------
   unsigned char                                               m_SpanValue[2];
	 
	 // --------------------------------------------------------------------------
   // DESCRIPTION: 采集次数Tag的Oid
   // --------------------------------------------------------------------------
   unsigned char                                               m_NumberOid[4]; 
   // --------------------------------------------------------------------------
   // DESCRIPTION: 采集次数Tag的Len
   // --------------------------------------------------------------------------
   unsigned char                                               m_NumberLen[2];  
   // --------------------------------------------------------------------------
   // DESCRIPTION: 采集次数Tag的Value
   // --------------------------------------------------------------------------
   unsigned char                                               m_NumberValue[2];
	 
	 	 // --------------------------------------------------------------------------
   // DESCRIPTION: 上传次数Tag的Oid
   // --------------------------------------------------------------------------
   unsigned char                                               m_UploadCountOid[4]; 
   // --------------------------------------------------------------------------
   // DESCRIPTION: 上传次数Tag的Len
   // --------------------------------------------------------------------------
   unsigned char                                               m_UploadCountLen[2];  
   // --------------------------------------------------------------------------
   // DESCRIPTION: 上传次数Tag的Value
   // --------------------------------------------------------------------------
   unsigned char                                               m_UploadCountValue[2];

	 // --------------------------------------------------------------------------
   // DESCRIPTION: CRC校验值
   // --------------------------------------------------------------------------
   unsigned char                                               m_CRC[2];  	
	  
} SLNoiseSet;


////结构体声明
//// -----------------------------------------------------------------------------
//// DESCRIPTION:
//// -----------------------------------------------------------------------------
//typedef struct _SLNoiseSet
//{
//   // --------------------------------------------------------------------------
//   // DESCRIPTION: 同步字符
//   // --------------------------------------------------------------------------
//   unsigned char                                               m_iHeader[4];
//   
//   // --------------------------------------------------------------------------
//   // DESCRIPTION: 报文操作命令
//   // --------------------------------------------------------------------------
//   unsigned char                                               m_iDTime[2];
//   
//   // --------------------------------------------------------------------------
//   // DESCRIPTION: 可选操作参数-A
//   // --------------------------------------------------------------------------
//   unsigned char                                               m_iDInter;
//      
//   // --------------------------------------------------------------------------
//   // DESCRIPTION: 可选操作参数-B
//   // --------------------------------------------------------------------------
//   unsigned char                                               m_iDNum;
//   
//   // --------------------------------------------------------------------------
//   // DESCRIPTION: ?可选操作参数-C
//   // --------------------------------------------------------------------------
//   unsigned char                                               m_iOpTim[2];
//   
//   // --------------------------------------------------------------------------
//   // DESCRIPTION: 可选操作参数-D
//   // --------------------------------------------------------------------------
//   unsigned char                                               m_iClsTim[2];
//      
//   // --------------------------------------------------------------------------
//   // DESCRIPTION: 报文长度
//   // --------------------------------------------------------------------------
//   unsigned char                                               m_iDistime[2];  
//   
//   // --------------------------------------------------------------------------
//   // DESCRIPTION: 报文的CRC校验码
//   // --------------------------------------------------------------------------
//   unsigned short                                              m_iDisInter;
//   
//   // --------------------------------------------------------------------------
//   // DESCRIPTION: 时间
//   // --------------------------------------------------------------------------
//   unsigned char                                               m_iTime[7]; 
//// --------------------------------------------------------------------------
//   // DESCRIPTION: 关机
//   // --------------------------------------------------------------------------
//   unsigned char                                               m_iShut;  
//// --------------------------------------------------------------------------
//   // DESCRIPTION: 测试
//   // --------------------------------------------------------------------------
//   unsigned char                                               m_iTest;  	
//	 // --------------------------------------------------------------------------
//   // DESCRIPTION: END
//   // --------------------------------------------------------------------------
//   unsigned char                                               m_iEnd;  	
//	  
//} SLNoiseSet;



// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#if defined ( __CC_ARM ) 

// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#pragma pop

// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#endif



///////////////////////////////////////////////////////////////////////////////
//函数声明
unsigned short CRC16( unsigned char * pMsg, unsigned short iSize );
unsigned short GetCoordinatorID (void);
//void  SendMessage(char* Psend, unsigned short iSize);
uint8_t   SendMessage(char* Psend, unsigned short iSize);
unsigned char  ReceiveMessageVerify(char*  pRecevBuff);
// -----------------------------------------------------------------------------
// DESCRIPTION: 是否是一个有效的报文，该报文必须有同步字符并且CRC验算正确
// -----------------------------------------------------------------------------
unsigned char IsValidNodeMsg( NodeMsg * pMsg );

// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
void UpdateNodeMsgCRC( NodeMsg * pMsg );

// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
//void WriteNodeMsg( unsigned char hFile, NodeMsg * pMsg );

 void SetNodeID (unsigned short sNodeID);


#endif

